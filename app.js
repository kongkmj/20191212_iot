const express=require("express"),path=require("path"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),hbs=require("express-handlebars"),http=require("http"),routes=require("./routes/index"),sensors=require("./routes/sensors"),devices=require("./routes/devices"),app=express(),server=http.createServer(app);global.io=require("socket.io").listen(server),app.set("views",path.join(__dirname,"views")),app.engine("hbs",hbs({extname:"hbs",defaultLayout:__dirname+"/views/layouts/layout.hbs",partialsDir:__dirname+"/views/partials",layoutDir:__dirname+"/views/layouts"})),app.set("view engine","hbs"),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0})),app.use(cookieParser()),app.use(express.static(path.join(__dirname,"public"))),app.use("/",routes),app.use("/sensors",sensors),app.use("/devices",devices);var nsp_bulb=io.of("/device/bulb");nsp_bulb.on("connection",function(e){console.log("bulb connected"),e.on("dash_bulb",function(e){"ON"==e&&nsp_bulb.emit("bulb_on","ON"),"OFF"==e&&nsp_bulb.emit("bulb_off","OFF")}),e.on("disconnect",function(){console.log("bulb disconnected")})});var nsp_air=io.of("/device/air");nsp_air.on("connection",function(e){console.log("air connected"),e.on("dash_air",function(e){console.log("air "+e),"ON"==e&&nsp_air.emit("air_on","ON"),"OFF"==e&&nsp_air.emit("air_off","OFF")}),e.on("disconnect",function(){console.log("air disconnected")})}),app.set("port",process.env.PORT||80),server.listen(app.get("port"),function(){console.log("Server started on port "+app.get("port"))});
